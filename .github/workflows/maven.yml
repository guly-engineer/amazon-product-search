name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
permissions:
  contents: write

jobs:
  build:

    runs-on: ubuntu-latest
    env:
      RUNNER_OS: true
      HEADLESS_CHROME: true

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven

    - name: Install Chrome
      uses: browser-actions/setup-chrome@latest

    - name: Cache Maven packages
      uses: actions/cache@v1
      with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2
    - name: Build with Maven
      run: xvfb-run mvn -B package --file pom.xml
      env:
        DISPLAY: 19
        CUCUMBER_PUBLISH_TOKEN: 6a0ca52d-bf14-4815-9486-d041f06bc024
    - name: Deploy ðŸš€
      if: always()
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: ./test-reports/cucumber-reports
        
    - name: Test Reporter
  # You may pin to the exact commit or the version.
  # uses: dorny/test-reporter@c9b3d0e2bd2a4e96aaf424dbaa31c46b42318226
      uses: dorny/test-reporter@v1.6.0
      with:
    # Name or regex of artifact containing test results
    artifact: # optional
    # Name of the check run
    name: Run Tests
    # Coma separated list of paths to test results
    path: "**/surefire-reports/TEST-*.xml"
  
    path-replace-backslashes: # optional, default is false
    # Format of test results. Supported options:

    reporter: java-junit
    # Limits which test suites are listed. Supported options:

    list-suites: # default is all
    # Limits which test cases are listed. Supported options:

    list-tests: # default is all
    # Limits number of created annotations with error message and stack trace captured during test execution.
Must be less or equal to 50.

    max-annotations: # default is 10
    # Set this action as failed if test report contain any failed test
    fail-on-error: # default is true
    # Relative path under $GITHUB_WORKSPACE where the repository was checked out
    working-directory: # optional
    # Allows you to generate only the summary.
If enabled, the report will contain a table listing each test results file and the number of passed, failed, and skipped tests.
Detailed listing of test suites and test cases will be skipped.

    only-summary: # optional, default is false
    # GitHub Access Token
    token: # optional, default is ${{ github.token }}
